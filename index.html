<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>AuraAI</title>
<!--
Â  Single-file Aura App updated with:
Â  - 100 categorized themes (Grayscale, Metallic, Gradient, Animated, Pastel, Poster)
Â  - New 'Gallery' and 'Upload' features for custom themes
Â  - Drawing pad
Â  - Music player
Â  - Bubble Pop Game with SFX
Â  - **NEW Emotion-Based Chatbot:**
Â  Â - Chatbot responds with one of four emotions (happy, sad, nervous, angry).
Â  Â - UI changes to match the chatbot's current emotion.
-->
<style>
:root{
Â  --pad:20px; --radius:16px;
Â  --glass-bg: rgba(255,255,255,0.40); /* Increased transparency */
Â  --glass-border: rgba(255,255,255,0.5); /* Increased border visibility */
Â  --glass-shadow: 0 24px 50px rgba(0,0,0,0.18); /* More prominent shadow */
Â  --accent-grad: linear-gradient(90deg,#a8cdf1 0%,#f7b7b9 100%);
Â  --text: #0b3c61;
Â  --muted: rgba(11,60,97,0.65);
}
/* Basic styles for all themes */
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:"Comic Neue",Arial,sans-serif;background:#a8cdf1;color:var(--text)}
body{display:flex;align-items:center;justify-content:center;overflow:hidden;transition:background-color .8s ease}
/* Animated theme backgrounds */
body.animated-theme { background: linear-gradient(270deg, #f7b7b9, #a8cdf1, #a8cdf1, #f7b7b9); background-size: 800% 800%; animation: gradientAnimation 20s ease infinite;}
@keyframes gradientAnimation { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
.screen{position:absolute;inset:0;display:none;place-items:center;padding:var(--pad)}
.screen.active{display:grid}
.glass{background:var(--glass-bg);backdrop-filter: blur(20px);-webkit-backdrop-filter: blur(20px);border:1px solid var(--glass-border);box-shadow:var(--glass-shadow);border-radius:var(--radius)}
.btn{border:0;cursor:pointer;border-radius:12px;padding:12px 14px;font-weight:800;font-size:15px;background:var(--accent-grad);color:var(--text);box-shadow:0 6px 16px rgba(168,205,241,.6);transition:transform .2s ease, filter .2s ease;}
.btn:hover{transform:translateY(-2px);filter:brightness(.95)}
/* main hello */
.hello-wrap{width:min(980px,92vw);padding:28px;text-align:center;border-radius:18px}
.hello-text{font-weight:900;font-size:clamp(36px,7vw,72px);margin:6px 0;background:linear-gradient(90deg, #5f7587, #c18f92);-webkit-background-clip:text;background-clip:text;color:transparent;user-select:none; text-shadow: 0 2px 4px rgba(0,0,0,0.25);}
.hello-sub{font-size:clamp(15px,2.4vw,20px);opacity:.9;margin-bottom:16px}
.hello-actions{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
.hint{margin-top:12px;font-size:13px;opacity:.8}
/* game */
.game-wrap{width:min(1000px,95vw);height:min(70vh,680px);padding:12px;display:grid;grid-template-rows:auto 1fr auto;gap:10px;border-radius:16px}
.bar{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
.title{font-weight:900;font-size:18px}
.game-ind{font-weight:800;padding:8px 12px;border-radius:12px;background:rgba(255,255,255,.6)}
.game-bottom-controls { display: flex; gap: 8px; justify-content: space-between; flex-wrap: wrap; }
/* draw */
.draw-wrap{width:min(1100px,96vw);height:min(76vh,740px);padding:12px;display:grid;grid-template-rows:auto 1fr auto;gap:10px;border-radius:16px}
.draw-tools{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.brush{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,.55);padding:6px 10px;border-radius:12px;font-weight:800}
.swatch{width:26px;height:26px;border-radius:50%;border:0;cursor:pointer;box-shadow:0 6px 14px rgba(0,0,0,.12)}
.toggle{display:flex;align-items:center;gap:6px;padding:6px 10px;border-radius:12px;background:rgba(255,255,255,.55);font-weight:800}
.draw-canvas{width:100%;height:100%;border-radius:14px;background:rgba(255,255,255,.85);outline:2px solid rgba(255,255,255,.5)}
.draw-bottom{display:flex;gap:8px;justify-content:space-between;flex-wrap:wrap}
.picker{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,.55);padding:6px 10px;border-radius:12px;font-weight:800}
.picker input[type=color]{border:none;width:42px;height:26px;border-radius:10px}
/* Themes panel */
.themes-panel{position:fixed;right:20px;top:60px;width:420px;max-height:80vh;overflow:auto;padding:12px;border-radius:14px;background:rgba(255,255,255,0.88);box-shadow:0 20px 40px rgba(0,0,0,0.18);border:1px solid rgba(0,0,0,0.06);z-index:1200;display:none;opacity:0;transform:translateY(20px);transition:opacity .3s ease, transform .3s ease;}
.themes-panel.active{display:block;opacity:1;transform:translateY(0);}
.themes-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;gap:8px}
.themes-head h4{margin:0;font-weight:900}
.theme-category-tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;}
.theme-category-tabs button{font-size:13px;padding:8px 12px;border-radius:10px;border:1px solid transparent;background:rgba(255,255,255,.6);color:var(--text);font-weight:700;}
.theme-category-tabs button.active{background:var(--accent-grad);border-color:#fff}
.themes-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;padding-top:10px}
.theme-box{height:80px;border-radius:12px;box-shadow:0 4-box-shadow:0 4px 12px rgba(0,0,0,0.1);cursor:pointer;transition:transform .2s ease, box-shadow .2s ease;border:2px solid transparent;overflow:hidden;position:relative}
.theme-box:hover{transform:scale(1.03);box-shadow:0 6px 16px rgba(0,0,0,0.15)}
.theme-box.active{border:2px solid #fff}
.theme-box.gallery-theme::after { content: 'ğŸ–¼ï¸'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 32px; z-index: 10; pointer-events: none; }
.theme-box.upload-theme::after { content: 'ğŸ“'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 32px; z-index: 10; pointer-events: none; }
.theme-box-label{position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,0.4);color:#fff;text-align:center;padding:4px;font-size:10px;font-weight:bold;display:none;opacity:0;transition:opacity .3s ease}
.theme-box:hover .theme-box-label{display:block;opacity:1}
.music-toggle{position:fixed;bottom:20px;right:20px;padding:10px 14px;border-radius:12px;background:rgba(255,255,255,0.85);box-shadow:0 6px 16px rgba(0,0,0,.15);cursor:pointer;display:flex;gap:8px;align-items:center;z-index:1100}
.music-toggle svg{height:20px;width:20px}
.music-toggle.on .pause-icon{display:none} .music-toggle.off .play-icon{display:none}
/* Message box overlay */
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);backdrop-filter:blur(5px);z-index:9999;display:flex;justify-content:center;align-items:center;opacity:0;visibility:hidden;transition:opacity 0.3s ease, visibility 0.3s ease}
.overlay.visible{opacity:1;visibility:visible}
.msg-box{background:#fff;padding:20px;border-radius:15px;text-align:center;box-shadow:0 10px 25px rgba(0,0,0,0.2);max-width:350px;animation: pop-in 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both}
.msg-box h3{margin-top:0;font-size:24px;color:#0b3c61}
.msg-box p{margin-bottom:20px;font-size:16px;color:#333}
.msg-box button{background:#a8cdf1;color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;font-weight:bold}
@keyframes pop-in{0%{transform:scale(0.8);opacity:0}100%{transform:scale(1);opacity:1}}
@font-face{font-family:"Comic Neue";src:url("https://fonts.gstatic.com/s/comicneue/v8/4UaAjXhSlzgzg8-H-qPPjVzLqjD-gYc.woff2") format("woff2");font-weight:400;font-style:normal;font-display:swap}
@font-face{font-family:"Comic Neue";src:url("https://fonts.gstatic.com/s/comicneue/v8/4UaAjXhSlzgzg8-H-qPPjVzLqjD-gZ0.woff2") format("woff2");font-weight:700;font-style:normal;font-display:swap}
@font-face{font-family:"Comic Neue";src:url("https://fonts.gstatic.com/s/comicneue/v8/4UaAjXhSlzgzg8-H-qPPjVzLqjD-gZ0.woff2") format("woff2");font-weight:800;font-style:normal;font-display:swap}
/* Chatbot Screen */
.chat-wrap { width: min(1100px, 96vw); height: min(76vh, 740px); padding: 12px; display: grid; grid-template-rows: auto 1fr auto; gap: 10px; border-radius: 16px; }
.chat-window { background: rgba(255, 255, 255, 0.6); border-radius: 14px; padding: 10px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; }
.message { max-width: 80%; padding: 10px; border-radius: 14px; line-height: 1.4; transition: all 0.3s ease; }
.user-msg { background: var(--accent-grad); color: var(--text); align-self: flex-end; }
.bot-msg { background: rgba(255, 255, 255, 0.8); color: #3c3c3c; align-self: flex-start; }
.chat-input-area { display: flex; gap: 10px; }
.chat-input { flex-grow: 1; padding: 12px; border-radius: 12px; border: 1px solid rgba(0,0,0,0.1); background: rgba(255, 255, 255, 0.85); color: #3c3c3c; font-family: "Comic Neue", Arial, sans-serif; }
.chat-send-btn { background: #4caf50; color: #fff; border: none; padding: 0 16px; border-radius: 12px; cursor: pointer; }
.chat-send-btn:hover { transform: translateY(-1px); }
.bot-emotion { font-size: 20px; margin-left: 8px; }

/* Emotion-based background color changes */
body.happy { background: linear-gradient(to bottom right, #ffeb3b, #8bc34a); }
body.happy .hello-text { background: linear-gradient(90deg, #5c6bc0, #ff8a65); -webkit-background-clip: text; color: transparent; }
body.happy .btn { background: linear-gradient(90deg, #ffc107, #ff9800); }

body.sad { background: linear-gradient(to bottom right, #90caf9, #42a5f5); }
body.sad .hello-text { background: linear-gradient(90deg, #1976d2, #0d47a1); -webkit-background-clip: text; color: transparent; }
body.sad .btn { background: linear-gradient(90deg, #2196f3, #42a5f5); }

body.angry { background: linear-gradient(to bottom right, #e53935, #ff5722); }
body.angry .hello-text { background: linear-gradient(90deg, #d32f2f, #b71c1c); -webkit-background-clip: text; color: transparent; }
body.angry .btn { background: linear-gradient(90deg, #f44336, #e57373); }

body.nervous { background: linear-gradient(to bottom right, #ffb74d, #ffa000); }
body.nervous .hello-text { background: linear-gradient(90deg, #ef6c00, #ff8f00); -webkit-background-clip: text; color: transparent; }
body.nervous .btn { background: linear-gradient(90deg, #ffc107, #ffb300); }
</style>
</head><body>

<!-- Screens -->
<div id="hello" class="screen active">
Â  <div class="glass hello-wrap">
Â  Â  <div class="hello-text">Welcome to AuraAI âœ¨</div>
Â  Â  <div class="hello-sub">Choose an activity to start.</div>
Â  Â  <div class="hello-actions">
Â  Â  Â  <button class="btn" onclick="showScreen('draw')">Start Drawing ğŸ¨</button>
Â  Â  Â  <button class="btn" onclick="showScreen('game')">Play a Game ğŸ®</button>
Â  Â  Â  <button class="btn" onclick="showScreen('chat')">Talk to Aura ğŸ’¬</button>
Â  Â  </div>
Â  </div>
</div>

<div id="draw" class="screen">
Â  <div class="glass draw-wrap">
Â  Â  <div class="bar">
Â  Â  Â  <div class="title">Drawing Pad ğŸ–Œï¸</div>
Â  Â  Â  <div class="draw-tools">
Â  Â  Â  Â  <div class="brush">
Â  Â  Â  Â  Â  Size: <input type="range" id="brush-size" min="1" max="50" value="10">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="picker">
Â  Â  Â  Â  Â  Color: <input type="color" id="brush-color" value="#000000">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="toggle">
Â  Â  Â  Â  Â  Eraser: <input type="checkbox" id="eraser-toggle">
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <canvas id="draw-canvas" class="draw-canvas"></canvas>
Â  Â  <div class="draw-bottom">
Â  Â  Â  <button class="btn" onclick="clearCanvas()">Clear ğŸ–¼ï¸</button>
Â  Â  Â  <button class="btn" onclick="saveDrawingAsTheme()">Save as Theme ğŸ’¾</button>
Â  Â  Â  <button class="btn" onclick="showScreen('hello')">Back Home ğŸ </button>
Â  Â  </div>
Â  Â  <button class="btn" id="theme-btn" onclick="toggleThemes()">Change Theme ğŸ¨</button>
Â  </div>
</div>

<div id="game" class="screen">
Â  <div class="glass game-wrap">
Â  Â  <div class="bar">
Â  Â  Â  <div class="title">Bubble Pop Game ğŸ«§</div>
Â  Â  Â  <div class="game-ind">Level: <span id="level-display">1</span></div>
Â  Â  Â  <div class="game-ind">Popped: <span id="bubbles-popped-display">0</span>/<span id="required-bubbles-display">10</span></div>
Â  Â  </div>
Â  Â  <canvas id="game-canvas" class="draw-canvas"></canvas>
Â  Â  <div class="game-bottom-controls">
Â  Â  Â  <button class="btn" id="start-game-btn">Start Game ğŸš€</button>
Â  Â  Â  <button class="btn" onclick="showScreen('hello')">Back Home ğŸ </button>
Â  Â  </div>
Â  </div>
</div>

<div id="chat" class="screen">
Â  <div class="glass chat-wrap">
Â  Â  <div class="bar">
Â  Â  Â  <div class="title">Talk to Aura ğŸ’¬</div>
Â  Â  Â  <div class="game-ind">
Â  Â  Â  Â  Aura feels: <span id="aura-emotion">Happy</span>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="chat-window" class="chat-window">
Â  Â  Â  <div class="message bot-msg">Hello there! I'm Aura. What's on your mind? <span class="bot-emotion">ğŸ˜Š</span></div>
Â  Â  </div>
Â  Â  <div class="chat-input-area">
Â  Â  Â  <input type="text" id="chat-input" class="chat-input" placeholder="Say something nice...">
Â  Â  Â  <button id="chat-send-btn" class="btn">Send</button>
Â  Â  </div>
Â  Â  <button class="btn" onclick="showScreen('hello')">Back Home ğŸ </button>
Â  </div>
</div>

<!-- Theme Panel -->
<div id="themes-panel" class="themes-panel">
Â  <div class="themes-head">
Â  Â  <h4>Choose a Theme ğŸŒˆ</h4>
Â  Â  <button class="btn" onclick="toggleThemes()">Close âœ–ï¸</button>
Â  </div>
Â  <div class="theme-category-tabs" id="theme-category-tabs"></div>
Â  <div id="themes-grid" class="themes-grid"></div>
</div>

<!-- Music Player -->
<div id="music-toggle" class="music-toggle off" onclick="toggleMusic()">
Â  <svg class="play-icon" viewBox="0 0 24 24" fill="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
Â  Â  <path d="M5 3l14 9-14 9V3z"></path>
Â  </svg>
Â  <svg class="pause-icon" viewBox="0 0 24 24" fill="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
Â  Â  <path d="M6 4h4v16H6zM14 4h4v16h-4z"></path>
Â  </svg>
Â  <span id="music-status">Music Off ğŸµ</span>
</div>
<audio id="bgm" loop=""></audio>

<!-- Bubble Pop SFX -->
<audio id="popSfx">
Â  <source src="https://assets.mixkit.co/sfx/preview/mixkit-bubble-pop-1127.mp3" type="audio/mpeg">
</audio>

<!-- Message Box Overlay -->
<div id="overlay" class="overlay">
Â  <div class="msg-box">
Â  Â  <h3 id="msg-title"></h3>
Â  Â  <p id="msg-text"></p>
Â  Â  <button id="msg-btn">OK</button>
Â  </div>
</div>

<script>
// --- Core App Logic ---
let activeScreenId = 'hello';
let currentTheme = { category: 'grayscale', name: 'Charcoal' };
const screens = {};
const savedGalleryThemesKey = 'aura-gallery-themes';
const themes = {
Â  // 100 THEMES IN TOTAL, organized by category
Â  'Grayscale': [
Â  Â  { name: 'Pure White', type: 'color', bg: '#ffffff', grad: '#f0f0f0', text: '#000000' },
Â  Â  { name: 'White Smoke', type: 'color', bg: '#F5F5F5', grad: '#E8E8E8', text: '#3c3c3c' },
Â  Â  { name: 'Light Gray', type: 'color', bg: '#d3d3d3', grad: '#c0c0c0', text: '#3c3c3c' },
Â  Â  { name: 'Silver Mist', type: 'color', bg: '#b0b0b0', grad: '#a0a0a0', text: '#fff' },
Â  Â  { name: 'Steel Gray', type: 'color', bg: '#708090', grad: '#6c7a89', text: '#fff' },
Â  Â  { name: 'Slate', type: 'color', bg: '#405d72', grad: '#3c586b', text: '#fff' },
Â  Â  { name: 'Gunmetal', type: 'color', bg: '#2c3539', grad: '#364044', text: '#fff' },
Â  Â  { name: 'Charcoal', type: 'color', bg: '#36454f', grad: '#2c3539', text: '#fff' },
Â  Â  { name: 'Dark Slate', type: 'color', bg: '#2f4f4f', grad: '#243c3c', text: '#fff' },
Â  Â  { name: 'Jet Black', type: 'color', bg: '#000000', grad: '#1a1a1a', text: '#fff' },
Â  Â  { name: 'White', type: 'color', bg: '#ffffff', text: '#000000' },
Â  Â  { name: 'Gray', type: 'color', bg: '#808080', text: '#fff' },
Â  Â  { name: 'Black', type: 'color', bg: '#000000', text: '#fff' },
Â  Â  { name: 'Off White', type: 'color', bg: '#fafafa', text: '#3c3c3c' },
Â  Â  { name: 'Dim Gray', type: 'color', bg: '#696969', text: '#fff' },
Â  Â  { name: 'Dark Gray', type: 'color', bg: '#a9a9a9', text: '#fff' },
Â  Â  { name: 'Slate Gray', type: 'color', bg: '#708090', text: '#fff' },
Â  Â  { name: 'Light Slate Gray', type: 'color', bg: '#778899', text: '#fff' },
Â  Â  { name: 'Dark Slate Gray', type: 'color', bg: '#2f4f4f', text: '#fff' },
Â  Â  { name: 'Snow', type: 'color', bg: '#FFFAFA', text: '#3c3c3c' },
Â  Â  { name: 'Ivory', type: 'color', bg: '#FFFFF0', text: '#3c3c3c' },
Â  Â  { name: 'Gainsboro', type: 'color', bg: '#DCDCDC', text: '#3c3c3c' },
Â  Â  { name: 'Alice Blue', type: 'color', bg: '#F0F8FF', text: '#3c3c3c' },
Â  Â  { name: 'Ghost White', type: 'color', bg: '#F8F8FF', text: '#3c3c3c' },
Â  Â  { name: 'Dark White', type: 'color', bg: '#F1F1F1', text: '#3c3c3c' },
Â  Â  { name: 'Midnight Blue', type: 'color', bg: '#191970', text: '#fff' },
Â  Â  { name: 'Dark Blue', type: 'color', bg: '#00008b', text: '#fff' },
Â  Â  { name: 'Steel Blue', type: 'color', bg: '#4682b4', text: '#fff' },
Â  Â  { name: 'Dark Steel Blue', type: 'color', bg: '#483d8b', text: '#fff' },
Â  Â  { name: 'Light Steel Blue', type: 'color', bg: '#b0c4de', text: '#3c3c3c' }
Â  ],
Â  'Gradient': [
Â  Â  { name: 'Aurora', type: 'color', bg: '#a8cdf1', grad: '#f7b7b9', text: '#0b3c61' },
Â  Â  { name: 'Sunset', type: 'color', bg: '#fdbb2d', grad: '#22c1c3', text: '#3c3c3c' },
Â  Â  { name: 'Forest', type: 'color', bg: '#43ac62', grad: '#6a9d77', text: '#f0f0f0' },
Â  Â  { name: 'Ocean', type: 'color', bg: '#005bea', grad: '#00c6fb', text: '#fff' },
Â  Â  { name: 'Lavender', type: 'color', bg: '#c495d4', grad: '#b669c6', text: '#fff' },
Â  Â  { name: 'Night Sky', type: 'color', bg: '#1c1c1c', grad: '#3f3f3f', text: '#fff' },
Â  Â  { name: 'Candy', type: 'color', bg: '#ff7e5f', grad: '#feb47b', text: '#fff' },
Â  Â  { name: 'Mint', type: 'color', bg: '#9de0ad', grad: '#45a247', text: '#fff' },
Â  Â  { name: 'Fire', type: 'color', bg: '#ff416c', grad: '#ff4b2b', text: '#fff' },
Â  Â  { name: 'Emerald', type: 'color', bg: '#56ab2f', grad: '#a8e063', text: '#fff' },
Â  Â  { name: 'Grape', type: 'color', bg: '#662d8c', grad: '#ed1e79', text: '#fff' },
Â  Â  { name: 'Sky', type: 'color', bg: '#a8c0ff', grad: '#3f2b96', text: '#fff' },
Â  Â  { name: 'Plum', type: 'color', bg: '#61045f', grad: '#ae2869', text: '#fff' },
Â  Â  { name: 'Rose', type: 'color', bg: '#fecfef', grad: '#ff9a9e', text: '#3c3c3c' },
Â  Â  { name: 'Aqua', type: 'color', bg: '#74ebd5', grad: '#acb6e5', text: '#3c3c3c' },
Â  Â  { name: 'Teal', type: 'color', bg: '#008b8b', grad: '#00ced1', text: '#fff' },
Â  Â  { name: 'Coral', type: 'color', bg: '#ff6b6b', grad: '#ffc87c', text: '#fff' },
Â  Â  { name: 'Violet', type: 'color', bg: '#8c52ff', grad: '#5ce1e6', text: '#fff' },
Â  Â  { name: 'Sunburst', type: 'color', bg: '#ff9900', grad: '#ffb366', text: '#fff' },
Â  Â  { name: 'Cobalt', type: 'color', bg: '#0047ab', grad: '#1e90ff', text: '#fff' },
Â  Â  { name: 'Denim', type: 'color', bg: '#1565c0', grad: '#2196f3', text: '#fff' },
Â  Â  { name: 'Sky Blue', type: 'color', bg: '#87ceeb', grad: '#b0e0e6', text: '#3c3c3c' },
Â  Â  { name: 'Tangerine', type: 'color', bg: '#f28500', grad: '#ff7518', text: '#fff' },
Â  Â  { name: 'Jade', type: 'color', bg: '#00a86b', grad: '#00a880', text: '#fff' },
Â  Â  { name: 'Turquoise', type: 'color', bg: '#40e0d0', grad: '#48d1cc', text: '#3c3c3c' },
Â  Â  { name: 'Indigo', type: 'color', bg: '#4b0082', grad: '#5c4179', text: '#fff' },
Â  Â  { name: 'Lilac', type: 'color', bg: '#b66dff', grad: '#c5a0d3', text: '#fff' },
Â  Â  { name: 'Forest Green', type: 'color', bg: '#013220', grad: '#015e34', text: '#fff' },
Â  Â  { name: 'Navy', type: 'color', bg: '#000080', grad: '#0000a0', text: '#fff' },
Â  Â  { name: 'Grapefruit', type: 'color', bg: '#ff6a6a', grad: '#ff66c4', text: '#fff' },
Â  Â  { name: 'Lagoon', type: 'color', bg: '#0061ff', grad: '#60efbc', text: '#fff' },
Â  Â  { name: 'Peaches', type: 'color', bg: '#ffb347', grad: '#ffcc33', text: '#fff' },
Â  Â  { name: 'Neon', type: 'color', bg: '#39ff14', grad: '#00ffc8', text: '#3c3c3c' },
Â  Â  { name: 'Cosmic', type: 'color', bg: '#232c3f', grad: '#48587c', text: '#fff' },
Â  Â  { name: 'Electric', type: 'color', bg: '#8e2de2', grad: '#4a00e0', text: '#fff' },
Â  Â  { name: 'Ocean 2', type: 'color', bg: '#06637e', grad: '#46a3b2', text: '#fff' }
Â  ],
Â  'Pastel': [
Â  Â  { name: 'Pastel Dreams', type: 'color', bg: '#ffb3ba', grad: '#ffdfba', text: '#3c3c3c' },
Â  Â  { name: 'Lemonade', type: 'color', bg: '#fffacd', grad: '#b3e0ff', text: '#3c3c3c' },
Â  Â  { name: 'Strawberry', type: 'color', bg: '#f1a89c', grad: '#f3c4c0', text: '#3c3c3c' },
Â  Â  { name: 'Aqua Mint', type: 'color', bg: '#b2fef8', grad: '#b5ffeb', text: '#3c3c3c' },
Â  Â  { name: 'Powder Blue', type: 'color', bg: '#b1d4e0', grad: '#b3d3e3', text: '#3c3c3c' },
Â  Â  { name: 'Wisteria', type: 'color', bg: '#c9b1e5', grad: '#c1b4e5', text: '#3c3c3c' },
Â  Â  { name: 'Dusty Rose', type: 'color', bg: '#e0c9c7', grad: '#e3d2cf', text: '#3c3c3c' },
Â  Â  { name: 'Lime', type: 'color', bg: '#c6ffdd', grad: '#fbd786', text: '#3c3c3c' },
Â  Â  { name: 'Sand', type: 'color', bg: '#f1d2b1', grad: '#e2bc91', text: '#4a3220' },
Â  Â  { name: 'Mystic', type: 'color', bg: '#d4c7f0', grad: '#a894cc', text: '#3c3c3c' },
Â  Â  { name: 'Cotton Candy', type: 'color', bg: '#ffb6c1', grad: '#ffa07a', text: '#3c3c3c' },
Â  Â  { name: 'Bubblegum', type: 'color', bg: '#ff85a1', grad: '#ffc0cb', text: '#fff' },
Â  Â  { name: 'Cloudy Sky', type: 'color', bg: '#d3e8f1', grad: '#e0f1f9', text: '#3c3c3c' },
Â  Â  { name: 'Soft Peach', type: 'color', bg: '#ffdab9', grad: '#ffc4b1', text: '#3c3c3c' },
Â  Â  { name: 'Seafoam', type: 'color', bg: '#b5e3d7', grad: '#aed9cb', text: '#3c3c3c' },
Â  Â  { name: 'Lilac Petals', type: 'color', bg: '#c8a2c8', grad: '#d4b7d4', text: '#3c3c3c' }
Â  ],
Â  'Metallic': [
Â  Â  { name: 'Gold', type: 'color', bg: '#b8924b', grad: '#d7c797', text: '#4a3220' },
Â  Â  { name: 'Silver', type: 'color', bg: '#c0c0c0', grad: '#d9d9d9', text: '#3c3c3c' },
Â  Â  { name: 'Bronze', type: 'color', bg: '#cd7f32', grad: '#8b4513', text: '#fff' },
Â  Â  { name: 'Copper', type: 'color', bg: '#b87333', grad: '#b56149', text: '#fff' },
Â  Â  { name: 'Platinum', type: 'color', bg: '#e5e4e2', grad: '#c0c0c0', text: '#3c3c3c' },
Â  Â  { name: 'Ruby', type: 'color', bg: '#e0115f', grad: '#c00742', text: '#fff' },
Â  Â  { name: 'Sapphire', type: 'color', bg: '#0f52ba', grad: '#0073e6', text: '#fff' },
Â  Â  { name: 'Emerald Gem', type: 'color', bg: '#046307', grad: '#05900a', text: '#fff' },
Â  Â  { name: 'Amethyst', type: 'color', bg: '#9966cc', grad: '#b399e5', text: '#fff' },
Â  Â  { name: 'Steel', type: 'color', bg: '#4682b4', grad: '#6a8db6', text: '#fff' },
Â  Â  { name: 'Chrome', type: 'color', bg: '#8d929b', grad: '#a2a7af', text: '#3c3c3c' },
Â  Â  { name: 'Rose Gold', type: 'color', bg: '#b76e79', grad: '#c18f8f', text: '#fff' }
Â  ],
Â  'Animated': [
Â  Â  { name: 'Shifting Rainbow', type: 'animated', grad: '#ff6b6b, #ffc87c, #d5a3ff, #8aff8a', text: '#fff' },
Â  Â  { name: 'Ocean Waves', type: 'animated', grad: '#005bea, #00c6fb, #61d7f6, #005bea', text: '#fff' },
Â  Â  { name: 'Forest Glow', type: 'animated', grad: '#43ac62, #6a9d77, #8bb87d, #43ac62', text: '#fff' },
Â  Â  { name: 'Cosmic Dust', type: 'animated', grad: '#1c1c1c, #3f3f3f, #5b5b5b, #1c1c1c', text: '#fff' },
Â  Â  { name: 'Liquid Fire', type: 'animated', grad: '#ff416c, #ff4b2b, #ff8c00, #ff416c', text: '#fff' },
Â  Â  { name: 'Cyber Blue', type: 'animated', grad: '#00ffc8, #006aff, #8a2be2, #00ffc8', text: '#fff' },
Â  Â  { name: 'Synthwave', type: 'animated', grad: '#8e2de2, #4a00e0, #ff007f, #8e2de2', text: '#fff' },
Â  Â  { name: 'Volcano', type: 'animated', grad: '#d21f3c, #ff4500, #ffd700, #d21f3c', text: '#fff' }
Â  ],
Â  'Poster': [
Â  Â  { name: 'Crimson', type: 'color', bg: '#8d0426', text: '#fff' },
Â  Â  { name: 'Slate', type: 'color', bg: '#405d72', text: '#fff' },
Â  Â  { name: 'Carbon', type: 'color', bg: '#232526', text: '#fff' },
Â  Â  { name: 'Ruby', type: 'color', bg: '#d62828', text: '#fff' },
Â  Â  { name: 'Mahogany', type: 'color', bg: '#4c1e19', text: '#fff' },
Â  Â  { name: 'Olive', type: 'color', bg: '#556b2f', text: '#fff' },
Â  Â  { name: 'Charcoal', type: 'color', bg: '#36454f', text: '#fff' },
Â  Â  { name: 'Lemon', type: 'color', bg: '#fff733', text: '#3c3c3c' },
Â  Â  { name: 'Azure', type: 'color', bg: '#007fff', text: '#fff' },
Â  Â  { name: 'Maroon', type: 'color', bg: '#800000', text: '#fff' },
Â  Â  { name: 'Jade', type: 'color', bg: '#00a86b', text: '#fff' },
Â  Â  { name: 'Navy Blue', type: 'color', bg: '#000080', text: '#fff' },
Â  Â  { name: 'Slate Gray', type: 'color', bg: '#708090', text: '#fff' },
Â  Â  { name: 'Chocolate', type: 'color', bg: '#7b3f00', text: '#fff' },
Â  Â  { name: 'Dark Green', type: 'color', bg: '#006400', text: '#fff' },
Â  Â  { name: 'Midnight', type: 'color', bg: '#0a0a23', text: '#fff' },
Â  Â  { name: 'Teal Green', type: 'color', bg: '#008080', text: '#fff' },
Â  Â  { name: 'Eggplant', type: 'color', bg: '#614051', text: '#fff' },
Â  Â  { name: 'Burnt Orange', type: 'color', bg: '#cc5500', text: '#fff' },
Â  Â  { name: 'Mustard', type: 'color', bg: '#ffdb58', text: '#3c3c3c' },
Â  Â  { name: 'Terracotta', type: 'color', bg: '#e2725b', text: '#fff' },
Â  Â  { name: 'Rust', type: 'color', bg: '#b7410e', text: '#fff' },
Â  Â  { name: 'Dark Cyan', type: 'color', bg: '#008b8b', text: '#fff' },
Â  Â  { name: 'Dark Magenta', type: 'color', bg: '#8b008b', text: '#fff' },
Â  Â  { name: 'Sienna', type: 'color', bg: '#a0522d', text: '#fff' },
Â  Â  { name: 'Olive Drab', type: 'color', bg: '#6b8e23', text: '#fff' },
Â  Â  { name: 'Pine Green', type: 'color', bg: '#01796f', text: '#fff' },
Â  Â  { name: 'Navy', type: 'color', bg: '#000080', text: '#fff' },
Â  Â  { name: 'Dark Slate Blue', type: 'color', bg: '#483d8b', text: '#fff' },
Â  Â  { name: 'Steel Blue', type: 'color', bg: '#4682b4', text: '#fff' },
Â  Â  { name: 'Slate Grey', type: 'color', bg: '#708090', text: '#fff' },
Â  Â  { name: 'Deep Sea', type: 'color', bg: '#003153', text: '#fff' },
Â  Â  { name: 'Oxblood', type: 'color', bg: '#4a0000', text: '#fff' },
Â  Â  { name: 'Graphite', type: 'color', bg: '#2f4f4f', text: '#fff' },
Â  Â  { name: 'Falu Red', type: 'color', bg: '#801818', text: '#fff' }
Â  ]
};

document.addEventListener('DOMContentLoaded', () => {
Â  // Initial setup for screens
Â  document.querySelectorAll('.screen').forEach(el => screens[el.id] = el);
Â  showScreen(activeScreenId);

Â  // Initialize all sections
Â  initMusicPlayer();
Â  initThemeSwitcher();
Â  initDrawingPadLogic();
Â  initBubbleGameLogic();
Â  initChatbotLogic();

Â  // Handle back button on mobile
Â  window.addEventListener('popstate', (event) => {
Â  Â  if (event.state && event.state.screen) {
Â  Â  Â  showScreen(event.state.screen);
Â  Â  }
Â  });
Â Â 
Â  // Push the initial state for the 'hello' screen
Â  history.pushState({ screen: 'hello' }, 'AuraAI Home', '#hello');
});

function showScreen(id) {
Â  // Push new state for browser history
Â  if (id !== activeScreenId) {
Â  Â  history.pushState({ screen: id }, `AuraAI ${id.charAt(0).toUpperCase() + id.slice(1)}`, `#${id}`);
Â  }

Â  // Hide all screens
Â  for (const screenId in screens) {
Â  Â  screens[screenId].classList.remove('active');
Â  }
Â  // Show the requested screen
Â  screens[id].classList.add('active');
Â  activeScreenId = id;
}

// --- Music Player ---
function initMusicPlayer() {
Â  const audio = document.getElementById('bgm');
Â  const musicToggle = document.getElementById('music-toggle');
Â  const musicStatus = document.getElementById('music-status');
Â Â 
Â  // Array of your music URLs from GitHub
Â  const musicUrls = [
Â  Â  'https://raw.githubusercontent.com/username/repository/main/path/to/bgm1.mp3',
Â  Â  'https://raw.githubusercontent.com/username/repository/main/path/to/bgm2.mp3',
Â  Â  'https://raw.githubusercontent.com/username/repository/main/path/to/bgm3.mp3'
Â  ];
Â  let currentTrackIndex = 0;

Â  // Function to load and play the next track
Â  function playNextTrack() {
Â  Â  audio.pause();
Â  Â  currentTrackIndex = (currentTrackIndex + 1) % musicUrls.length;
Â  Â  audio.src = musicUrls[currentTrackIndex];
Â  Â  audio.load();
Â  Â  audio.play();
Â  }

Â  audio.addEventListener('ended', playNextTrack);

Â  window.toggleMusic = function() {
Â  Â  if (musicUrls.length === 0 || musicUrls[0] === 'https://raw.githubusercontent.com/username/repository/main/path/to/bgm1.mp3') {
Â  Â  Â  showMessageBox('No Music', 'Please add your music URLs to the code.', 'OK');
Â  Â  Â  return;
Â  Â  }

Â  Â  if (musicToggle.classList.contains('on')) {
Â  Â  Â  audio.pause();
Â  Â  Â  musicToggle.classList.remove('on');
Â  Â  Â  musicToggle.classList.add('off');
Â  Â  Â  musicStatus.textContent = 'Music Off ğŸµ';
Â  Â  } else {
Â  Â  Â  if (!audio.src) {
Â  Â  Â  Â  audio.src = musicUrls[currentTrackIndex];
Â  Â  Â  }
Â  Â  Â  audio.play().catch(e => {
Â  Â  Â  Â  if (e.name === "NotSupportedError") {
Â  Â  Â  Â  Â  showMessageBox('Error', 'Music playback failed. Please check the URLs in your code to make sure they are raw audio files.', 'OK');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  showMessageBox('Error', `Music playback failed: ${e.message}.`, 'OK');
Â  Â  Â  Â  }
Â  Â  Â  Â  console.error("Audio playback error:", e);
Â  Â  Â  Â  audio.pause();
Â  Â  Â  Â  musicToggle.classList.remove('on');
Â  Â  Â  Â  musicToggle.classList.add('off');
Â  Â  Â  Â  musicStatus.textContent = 'Music Off ğŸµ';
Â  Â  Â  });
Â  Â  Â  musicToggle.classList.remove('off');
Â  Â  Â  musicToggle.classList.add('on');
Â  Â  Â  musicStatus.textContent = 'Music On ğŸ¶';
Â  Â  }
Â  };
}

// --- Message Box Functions ---
function showMessageBox(title, message, buttonText) {
Â  Â  const overlay = document.getElementById('overlay');
Â  Â  const msgTitle = document.getElementById('msg-title');
Â  Â  const msgText = document.getElementById('msg-text');
Â  Â  const msgBtn = document.getElementById('msg-btn');
Â  Â Â 
Â  Â  msgTitle.textContent = title;
Â  Â  msgText.textContent = message;
Â  Â  msgBtn.textContent = buttonText;
Â  Â Â 
Â  Â  overlay.classList.add('visible');
Â  Â Â 
Â  Â  return new Promise(resolve => {
Â  Â  Â  Â  msgBtn.onclick = () => {
Â  Â  Â  Â  Â  Â  overlay.classList.remove('visible');
Â  Â  Â  Â  Â  Â  resolve();
Â  Â  Â  Â  };
Â  Â  });
}


// --- Theme Switcher ---
function initThemeSwitcher() {
Â  const themesGrid = document.getElementById('themes-grid');
Â  const categoryTabs = document.getElementById('theme-category-tabs');
Â  const themesPanel = document.getElementById('themes-panel');
Â  const categories = ['Grayscale', 'Gradient', 'Pastel', 'Metallic', 'Animated', 'Poster', 'Gallery', 'Upload'];
Â Â 
Â  let currentCategory = 'Grayscale';

Â  // Load saved gallery themes from local storage
Â  let savedGalleryThemes = JSON.parse(localStorage.getItem(savedGalleryThemesKey)) || [];

Â  function renderCategories() {
Â  Â  categoryTabs.innerHTML = '';
Â  Â  categories.forEach(category => {
Â  Â  Â  const btn = document.createElement('button');
Â  Â  Â  btn.textContent = category;
Â  Â  Â  if (category === currentCategory) {
Â  Â  Â  Â  btn.classList.add('active');
Â  Â  Â  }
Â  Â  Â  btn.onclick = () => {
Â  Â  Â  Â  currentCategory = category;
Â  Â  Â  Â  renderCategories(); // Re-render to update active state
Â  Â  Â  Â  renderThemes(category);
Â  Â  Â  };
Â  Â  Â  categoryTabs.appendChild(btn);
Â  Â  });
Â  }

Â  function renderThemes(category) {
Â  Â  themesGrid.innerHTML = '';
Â  Â  let themesToDisplay = [];
Â  Â Â 
Â  Â  if (category === 'Gallery') {
Â  Â  Â  themesToDisplay = savedGalleryThemes.map((img, index) => ({
Â  Â  Â  Â  name: `My Drawing ${index + 1}`,
Â  Â  Â  Â  type: 'gallery',
Â  Â  Â  Â  dataUrl: img
Â  Â  Â  }));
Â  Â  Â  // Add a placeholder for adding new drawings
Â  Â  Â  themesToDisplay.push({ name: 'Save a new one!', type: 'gallery-save', bg: 'rgba(0,0,0,0.1)' });
Â  Â  } else if (category === 'Upload') {
Â  Â  Â  themesToDisplay = [{ name: 'Upload Image', type: 'upload', bg: 'rgba(0,0,0,0.1)' }];
Â  Â  } else {
Â  Â  Â  themesToDisplay = themes[category];
Â  Â  }
Â  Â Â 
Â  Â  themesToDisplay.forEach((theme, index) => {
Â  Â  Â  const box = document.createElement('div');
Â  Â  Â  box.className = 'theme-box';
Â  Â  Â  if (theme === currentTheme) { box.classList.add('active'); }
Â  Â  Â Â 
Â  Â  Â  if (theme.type === 'color' || theme.type === 'animated') {
Â  Â  Â  Â  // Apply gradient or solid color
Â  Â  Â  Â  box.style.background = theme.type === 'animated'
Â  Â  Â  Â  Â  ? `linear-gradient(270deg, ${theme.grad})`
Â  Â  Â  Â  Â  : `linear-gradient(to bottom right, ${theme.bg}, ${theme.grad || theme.bg})`;
Â  Â  Â  Â  const label = document.createElement('span');
Â  Â  Â  Â  label.className = 'theme-box-label';
Â  Â  Â  Â  label.textContent = theme.name;
Â  Â  Â  Â  box.appendChild(label);
Â  Â  Â  Â  box.onclick = () => {
Â  Â  Â  Â  Â  applyTheme(theme);
Â  Â  Â  Â  Â  currentTheme = theme;
Â  Â  Â  Â  Â  renderThemes(currentCategory);
Â  Â  Â  Â  Â  showMessageBox('Theme Applied', `Theme "${theme.name}" has been applied!`, 'OK');
Â  Â  Â  Â  };
Â  Â  Â  } else if (theme.type === 'gallery') {
Â  Â  Â  Â  box.classList.add('gallery-theme');
Â  Â  Â  Â  box.style.backgroundImage = `url(${theme.dataUrl})`;
Â  Â  Â  Â  box.style.backgroundSize = 'cover';
Â  Â  Â  Â  box.style.backgroundPosition = 'center';
Â  Â  Â  Â  const label = document.createElement('span');
Â  Â  Â  Â  label.className = 'theme-box-label';
Â  Â  Â  Â  label.textContent = theme.name;
Â  Â  Â  Â  box.appendChild(label);
Â  Â  Â  Â  box.onclick = () => {
Â  Â  Â  Â  Â  applyTheme({ type: 'drawing', dataUrl: theme.dataUrl });
Â  Â  Â  Â  Â  currentTheme = theme;
Â  Â  Â  Â  Â  renderThemes(currentCategory);
Â  Â  Â  Â  Â  showMessageBox('Theme Applied', `Your drawing has been applied as the background!`, 'OK');
Â  Â  Â  Â  };
Â  Â  Â  } else if (theme.type === 'gallery-save') {
Â  Â  Â  Â  box.style.backgroundColor = 'rgba(0,0,0,0.1)';
Â  Â  Â  Â  box.style.backgroundImage = 'none';
Â  Â  Â  Â  box.style.border = '2px dashed rgba(0,0,0,0.2)';
Â  Â  Â  Â  const icon = document.createElement('span');
Â  Â  Â  Â  icon.textContent = 'ğŸ–¼ï¸';
Â  Â  Â  Â  icon.style.fontSize = '32px';
Â  Â  Â  Â  box.style.display = 'grid';
Â  Â  Â  Â  box.style.placeItems = 'center';
Â  Â  Â  Â  box.onclick = () => {
Â  Â  Â  Â  Â  showScreen('draw');
Â  Â  Â  Â  };
Â  Â  Â  Â  box.appendChild(icon);
Â  Â  Â  } else if (theme.type === 'upload') {
Â  Â  Â  Â  box.style.backgroundColor = 'rgba(0,0,0,0.1)';
Â  Â  Â  Â  box.style.backgroundImage = 'none';
Â  Â  Â  Â  box.style.border = '2px dashed rgba(0,0,0,0.2)';
Â  Â  Â  Â  const icon = document.createElement('span');
Â  Â  Â  Â  icon.textContent = 'ğŸ“';
Â  Â  Â  Â  icon.style.fontSize = '32px';
Â  Â  Â  Â  box.style.display = 'grid';
Â  Â  Â  Â  box.style.placeItems = 'center';
Â  Â  Â  Â  box.onclick = () => {
Â  Â  Â  Â  Â  const input = document.createElement('input');
Â  Â  Â  Â  Â  input.type = 'file';
Â  Â  Â  Â  Â  input.accept = 'image/*';
Â  Â  Â  Â  Â  input.onchange = (e) => {
Â  Â  Â  Â  Â  Â  const file = e.target.files[0];
Â  Â  Â  Â  Â  Â  if (file) {
Â  Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  Â  reader.onload = (event) => {
Â  Â  Â  Â  Â  Â  Â  Â  const dataUrl = event.target.result;
Â  Â  Â  Â  Â  Â  Â  Â  applyTheme({ type: 'uploaded', dataUrl: dataUrl });
Â  Â  Â  Â  Â  Â  Â  Â  showMessageBox('Theme Applied', 'Your uploaded image has been applied!', 'OK');
Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  input.click();
Â  Â  Â  Â  };
Â  Â  Â  Â  box.appendChild(icon);
Â  Â  Â  }
Â  Â  Â  themesGrid.appendChild(box);
Â  Â  });
Â  }

Â  window.applyTheme = function(theme) {
Â  Â  const body = document.body;
Â  Â  body.className = '';
Â  Â Â 
Â  Â  if (theme.type === 'color') {
Â  Â  Â  body.style.background = `linear-gradient(to bottom right, ${theme.bg}, ${theme.grad || theme.bg})`;
Â  Â  Â  document.documentElement.style.setProperty('--text', theme.text);
Â  Â  Â  document.documentElement.style.setProperty('--accent-grad', `linear-gradient(90deg, ${theme.bg} 0%, ${theme.grad || theme.bg} 100%)`);
Â  Â  } else if (theme.type === 'animated') {
Â  Â  Â  body.classList.add('animated-theme');
Â  Â  Â  body.style.background = `linear-gradient(270deg, ${theme.grad})`;
Â  Â  Â  document.documentElement.style.setProperty('--text', theme.text);
Â  Â  Â  document.documentElement.style.setProperty('--accent-grad', `linear-gradient(90deg, ${theme.grad.split(',')[0]} 0%, ${theme.grad.split(',').pop()} 100%)`);
Â  Â  } else if (theme.type === 'drawing' || theme.type === 'uploaded') {
Â  Â  Â  body.style.background = `url(${theme.dataUrl}) no-repeat center center / cover`;
Â  Â  Â  // Optionally reset colors for better readability
Â  Â  Â  document.documentElement.style.setProperty('--text', '#fff');
Â  Â  Â  document.documentElement.style.setProperty('--accent-grad', `linear-gradient(90deg, #a8cdf1 0%, #f7b7b9 100%)`);
Â  Â  }
Â  };
Â Â 
Â  window.toggleThemes = function() {
Â  Â  themesPanel.classList.toggle('active');
Â  Â  // Re-render themes to show latest gallery when panel opens
Â  Â  if (themesPanel.classList.contains('active')) {
Â  Â  Â  savedGalleryThemes = JSON.parse(localStorage.getItem(savedGalleryThemesKey)) || [];
Â  Â  Â  renderThemes(currentCategory);
Â  Â  }
Â  };

Â  // Initial render
Â  renderCategories();
Â  renderThemes(currentCategory);
}

// --- Drawing Pad Logic ---
function initDrawingPadLogic() {
Â  const canvas = document.getElementById('draw-canvas');
Â  const ctx = canvas.getContext('2d');
Â  const brushSizeInput = document.getElementById('brush-size');
Â  const brushColorInput = document.getElementById('brush-color');
Â  const eraserToggle = document.getElementById('eraser-toggle');
Â  let isDrawing = false;
Â  let lastX = 0;
Â  let lastY = 0;

Â  // Set canvas size on initial load and resize
Â  function resizeCanvas() {
Â  Â  const parent = canvas.parentElement;
Â  Â  canvas.width = parent.clientWidth;
Â  Â  canvas.height = parent.clientHeight;
Â  }

Â  window.addEventListener('resize', resizeCanvas);
Â  resizeCanvas(); // Initial resize

Â  function startDrawing(e) {
Â  Â  isDrawing = true;
Â  Â  [lastX, lastY] = getMousePos(e);
Â  }

Â  function draw(e) {
Â  Â  if (!isDrawing) return;
Â  Â  e.preventDefault();
Â Â 
Â  Â  ctx.strokeStyle = eraserToggle.checked ? '#ffffff' : brushColorInput.value;
Â  Â  ctx.lineWidth = brushSizeInput.value;
Â  Â  ctx.lineCap = 'round';
Â  Â  ctx.lineJoin = 'round';
Â  Â Â 
Â  Â  const { x, y } = getMousePos(e);
Â Â 
Â  Â  ctx.beginPath();
Â  Â  ctx.moveTo(lastX, lastY);
Â  Â  ctx.lineTo(x, y);
Â  Â  ctx.stroke();
Â Â 
Â  Â  [lastX, lastY] = [x, y];
Â  }

Â  function stopDrawing() {
Â  Â  isDrawing = false;
Â  }

Â  function getMousePos(e) {
Â  Â  const rect = canvas.getBoundingClientRect();
Â  Â  const clientX = e.clientX || e.touches[0].clientX;
Â  Â  const clientY = e.clientY || e.touches[0].clientY;
Â  Â  return {
Â  Â  Â  x: clientX - rect.left,
Â  Â  Â  y: clientY - rect.top
Â  Â  };
Â  }

Â  // Event listeners for mouse and touch
Â  canvas.addEventListener('mousedown', startDrawing);
Â  canvas.addEventListener('mousemove', draw);
Â  canvas.addEventListener('mouseup', stopDrawing);
Â  canvas.addEventListener('mouseout', stopDrawing);
Â  canvas.addEventListener('touchstart', startDrawing);
Â  canvas.addEventListener('touchmove', draw);
Â  canvas.addEventListener('touchend', stopDrawing);
Â Â 
Â  window.clearCanvas = function() {
Â  Â  ctx.clearRect(0, 0, canvas.width, canvas.height);
Â  Â  showMessageBox('Canvas Cleared', 'Your drawing has been erased.', 'OK');
Â  };

Â  window.saveDrawingAsTheme = function() {
Â  Â  const dataUrl = canvas.toDataURL('image/png');
Â  Â  let themes = JSON.parse(localStorage.getItem(savedGalleryThemesKey)) || [];
Â  Â  themes.push(dataUrl);
Â  Â  localStorage.setItem(savedGalleryThemesKey, JSON.stringify(themes));
Â  Â  showMessageBox('Saved!', 'Your drawing has been saved to the Gallery.', 'OK');
Â  };
}

// --- Bubble Pop Game Logic ---
function initBubbleGameLogic() {
Â  const canvas = document.getElementById('game-canvas');
Â  const ctx = canvas.getContext('2d');
Â  const levelDisplay = document.getElementById('level-display');
Â  const bubblesPoppedDisplay = document.getElementById('bubbles-popped-display');
Â  const requiredBubblesDisplay = document.getElementById('required-bubbles-display');
Â  const startGameBtn = document.getElementById('start-game-btn');
Â  const popSfx = document.getElementById('popSfx');

Â  const TOTAL_LEVELS = 30;
Â  const LEVEL_DATA = [];
Â  for (let i = 1; i <= TOTAL_LEVELS; i++) {
Â  Â  LEVEL_DATA.push({
Â  Â  Â  required: 5 + i * 2, // 7 bubbles on level 1, 9 on level 2, etc.
Â  Â  Â  spawnRate: 0.005 + i * 0.002, // Bubbles spawn faster each level
Â  Â  Â  maxSpeed: 1.5 + i * 0.2 // Max bubble speed increases
Â  Â  });
Â  }

Â  let bubbles = [];
Â  let gameRunning = false;
Â  let currentLevel = 1;
Â  let bubblesPopped = 0;
Â  let animationFrameId;

Â  // Encouragement messages
Â  const encouragements = [
Â  Â  "You're off to a great start!",
Â  Â  "Keep up the excellent work!",
Â  Â  "Way to go! You're a natural!",
Â  Â  "Amazing! You're getting faster!",
Â  Â  "Incredible! You're a pro!",
Â  Â  "You did it! Onward to the next challenge!",
Â  Â  "Nothing can stop you now!",
Â  Â  "Superstar! Just a few more levels!",
Â  Â  "Unbelievable! You're almost at the top!",
Â  Â  "Congratulations! You've mastered the bubbles!"
Â  ];

Â  function resizeCanvas() {
Â  Â  const parent = canvas.parentElement;
Â  Â  canvas.width = parent.clientWidth;
Â  Â  canvas.height = parent.clientHeight;
Â  }
Â  window.addEventListener('resize', resizeCanvas);
Â  resizeCanvas();

Â  function createBubble() {
Â  Â  const levelInfo = LEVEL_DATA[currentLevel - 1];
Â  Â  const radius = Math.random() * 20 + 15; // 15 to 35
Â  Â  const x = Math.random() * (canvas.width - radius * 2) + radius;
Â  Â  const y = canvas.height + radius;
Â  Â  const speed = Math.random() * levelInfo.maxSpeed + 0.5; // 0.5 to maxSpeed
Â  Â  const hue = Math.random() * 360; // Random color hue
Â  Â  bubbles.push({ x, y, radius, speed, hue, isPopping: false, popProgress: 0 });
Â  }

Â  function drawBubbles() {
Â  Â  ctx.clearRect(0, 0, canvas.width, canvas.height);
Â  Â  bubbles.forEach(bubble => {
Â  Â  Â  if (bubble.isPopping) {
Â  Â  Â  Â  // Popping animation: scale down and fade out
Â  Â  Â  Â  const popScale = 1 - bubble.popProgress;
Â  Â  Â  Â  const popOpacity = 1 - bubble.popProgress;
Â  Â  Â  Â  ctx.globalAlpha = popOpacity;
Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  ctx.arc(bubble.x, bubble.y, bubble.radius * popScale, 0, Math.PI * 2);
Â  Â  Â  Â  ctx.fillStyle = `hsl(${bubble.hue}, 80%, 75%)`;
Â  Â  Â  Â  ctx.fill();
Â  Â  Â  Â  ctx.closePath();
Â  Â  Â  Â  ctx.globalAlpha = 1; // Reset alpha
Â  Â  Â  } else {
Â  Â  Â  Â  // Draw normal bubble with a glassy effect
Â  Â  Â  Â  const gradient = ctx.createRadialGradient(
Â  Â  Â  Â  Â  bubble.x - bubble.radius / 3, bubble.y - bubble.radius / 3, bubble.radius / 4,
Â  Â  Â  Â  Â  bubble.x, bubble.y, bubble.radius
Â  Â  Â  Â  );
Â  Â  Â  Â  gradient.addColorStop(0, `hsla(${bubble.hue}, 100%, 85%, 0.8)`);
Â  Â  Â  Â  gradient.addColorStop(0.7, `hsla(${bubble.hue}, 80%, 65%, 0.5)`);
Â  Â  Â  Â  gradient.addColorStop(1, `hsla(${bubble.hue}, 60%, 50%, 0)`);
Â  Â  Â  Â  ctx.fillStyle = gradient;
Â  Â  Â  Â  ctx.beginPath();
Â  Â  Â  Â  ctx.arc(bubble.x, bubble.y, bubble.radius, 0, Math.PI * 2);
Â  Â  Â  Â  ctx.fill();
Â  Â  Â  Â  ctx.closePath();
Â  Â  Â  }
Â  Â  });
Â  }

Â  function updateBubbles() {
Â  Â  for (let i = bubbles.length - 1; i >= 0; i--) {
Â  Â  Â  const bubble = bubbles[i];
Â  Â  Â  if (bubble.isPopping) {
Â  Â  Â  Â  bubble.popProgress += 0.08; // Increase pop animation progress
Â  Â  Â  Â  if (bubble.popProgress >= 1) {
Â  Â  Â  Â  Â  bubbles.splice(i, 1); // Remove from array when animation is done
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  bubble.y -= bubble.speed;
Â  Â  Â  Â  // Remove bubbles that have gone off-screen
Â  Â  Â  Â  if (bubble.y + bubble.radius < 0) {
Â  Â  Â  Â  Â  bubbles.splice(i, 1);
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }
Â  }

Â  function gameLoop() {
Â  Â  if (!gameRunning) return;
Â  Â  const levelInfo = LEVEL_DATA[currentLevel - 1];

Â  Â  // Create a new bubble based on the level's spawn rate
Â  Â  if (Math.random() < levelInfo.spawnRate) {
Â  Â  Â  createBubble();
Â  Â  }

Â  Â  updateBubbles();
Â  Â  drawBubbles();
Â  Â  animationFrameId = requestAnimationFrame(gameLoop);
Â  }

Â  function checkLevelComplete() {
Â  Â  const levelInfo = LEVEL_DATA[currentLevel - 1];
Â  Â  if (bubblesPopped >= levelInfo.required) {
Â  Â  Â  cancelAnimationFrame(animationFrameId);
Â  Â  Â  gameRunning = false;
Â  Â  Â Â 
Â  Â  Â  if (currentLevel < TOTAL_LEVELS) {
Â  Â  Â  Â  const encouragementMsg = encouragements[Math.floor(Math.random() * encouragements.length)];
Â  Â  Â  Â  showMessageBox('Level Complete!', `Level ${currentLevel} cleared! ${encouragementMsg}`, 'Next Level â–¶ï¸').then(() => {
Â  Â  Â  Â  Â  currentLevel++;
Â  Â  Â  Â  Â  startGame();
Â  Â  Â  Â  });
Â  Â  Â  } else {
Â  Â  Â  Â  showMessageBox('YOU WIN!', `Congratulations! You've popped your way through all ${TOTAL_LEVELS} levels!`, 'Play Again ğŸ‰').then(() => {
Â  Â  Â  Â  Â  currentLevel = 1;
Â  Â  Â  Â  Â  startGame();
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  }
Â  }

Â  function getDistance(x1, y1, x2, y2) {
Â  Â  return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
Â  }

Â  canvas.addEventListener('click', (e) => {
Â  Â  if (!gameRunning) return;
Â  Â  const rect = canvas.getBoundingClientRect();
Â  Â  const mouseX = e.clientX - rect.left;
Â  Â  const mouseY = e.clientY - rect.top;

Â  Â  for (let i = bubbles.length - 1; i >= 0; i--) {
Â  Â  Â  const bubble = bubbles[i];
Â  Â  Â  if (!bubble.isPopping && getDistance(mouseX, mouseY, bubble.x, bubble.y) < bubble.radius) {
Â  Â  Â  Â  popSfx.play();
Â  Â  Â  Â  bubblesPopped++;
Â  Â  Â  Â  bubblesPoppedDisplay.textContent = bubblesPopped;
Â  Â  Â  Â  bubble.isPopping = true; // Start the pop animation
Â  Â  Â  Â  checkLevelComplete();
Â  Â  Â  Â  break; // Pop only one bubble per click
Â  Â  Â  }
Â  Â  }
Â  });

Â  function startGame() {
Â  Â  // Reset game state for the new level
Â  Â  bubbles = [];
Â  Â  bubblesPopped = 0;
Â  Â  levelDisplay.textContent = currentLevel;
Â  Â  bubblesPoppedDisplay.textContent = bubblesPopped;
Â  Â  requiredBubblesDisplay.textContent = LEVEL_DATA[currentLevel - 1].required;
Â  Â Â 
Â  Â  startGameBtn.textContent = 'Stop Game ğŸ›‘';
Â  Â  gameRunning = true;
Â  Â  gameLoop();
Â  }
Â Â 
Â  startGameBtn.addEventListener('click', () => {
Â  Â  if (!gameRunning) {
Â  Â  Â  startGame();
Â  Â  } else {
Â  Â  Â  startGameBtn.textContent = 'Start Game ğŸš€';
Â  Â  Â  gameRunning = false;
Â  Â  Â  cancelAnimationFrame(animationFrameId);
Â  Â  Â  bubbles = [];
Â  Â  Â  drawBubbles();
Â  Â  }
Â  });
}

// --- Chatbot Logic ---
function initChatbotLogic() {
Â  const chatWindow = document.getElementById('chat-window');
Â  const chatInput = document.getElementById('chat-input');
Â  const chatSendBtn = document.getElementById('chat-send-btn');
Â  const auraEmotionDisplay = document.getElementById('aura-emotion');
Â  const body = document.body;
Â Â 
Â  const initialTheme = currentTheme;

Â  const emotionThemes = {
Â  Â  happy: { class: 'happy', emoji: 'ğŸ˜Š' },
Â  Â  sad: { class: 'sad', emoji: 'ğŸ˜”' },
Â  Â  nervous: { class: 'nervous', emoji: 'ğŸ˜¬' },
Â  Â  angry: { class: 'angry', emoji: 'ğŸ˜¡' }
Â  };

Â  function setBotEmotion(emotion) {
Â  Â  const theme = emotionThemes[emotion];
Â  Â  if (theme) {
Â  Â  Â  body.className = theme.class;
Â  Â  Â  auraEmotionDisplay.textContent = `${emotion.charAt(0).toUpperCase() + emotion.slice(1)} ${theme.emoji}`;
Â  Â  } else {
Â  Â  Â  applyTheme(initialTheme);
Â  Â  Â  auraEmotionDisplay.textContent = `Default âœ¨`;
Â  Â  }
Â  }

Â  function createMessage(text, isUser = false) {
Â  Â  const messageDiv = document.createElement('div');
Â  Â  messageDiv.className = `message ${isUser ? 'user-msg' : 'bot-msg'}`;
Â  Â  messageDiv.textContent = text;
Â  Â  chatWindow.appendChild(messageDiv);
Â  Â  chatWindow.scrollTop = chatWindow.scrollHeight;
Â  }

Â  async function generateChatResponse(userMessage) {
Â  Â  createMessage('Aura is thinking...', false); // Placeholder message
Â Â 
Â  Â  try {
Â  Â  Â  const prompt = `The user is feeling an emotion. Respond to their message with a specific tone that matches one of these four emotions: 'happy', 'sad', 'nervous', or 'angry'. The response must be in JSON format with two keys: "emotion" and "text".
Â  Â  Â  
Â  Â  Â  For each emotion, the chatbot's personality is as follows:
Â  Â  Â  * **Happy:** The chatbot is cheerful, supportive, and energetic. It responds with positive affirmations and excitement.
Â  Â  Â  * **Sad:** The chatbot is empathetic and gentle. It validates the user's feelings, offering comfort and understanding.
Â  Â  Â  * **Nervous:** The chatbot is cautious and hesitant. It offers reassuring but tentative advice, sometimes expressing its own worry.
Â  Â  Â  * **Angry:** The chatbot is confrontational and direct. It challenges the user's negativity and pushes them to find a solution.

Â  Â  Â  IMPORTANT: Ensure the chatbot response is concise and natural, reflecting the persona accurately. Do not use emojis in the text itself.
Â  Â  Â  
Â  Â  Â  User message: "${userMessage}"`;

Â  Â  Â  let chatHistory = [];
Â  Â  Â  chatHistory.push({ role: "user", parts: [{ text: prompt }] });
Â  Â  Â  const payload = {
Â  Â  Â  Â  contents: chatHistory,
Â  Â  Â  Â  generationConfig: {
Â  Â  Â  Â  Â  responseMimeType: "application/json",
Â  Â  Â  Â  Â  responseSchema: {
Â  Â  Â  Â  Â  Â  type: "OBJECT",
Â  Â  Â  Â  Â  Â  properties: {
Â  Â  Â  Â  Â  Â  Â  "emotion": { "type": "STRING", "enum": ["happy", "sad", "nervous", "angry"] },
Â  Â  Â  Â  Â  Â  Â  "text": { "type": "STRING" }
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  "propertyOrdering": ["emotion", "text"]
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  };
Â  Â  Â  const apiKey = ""
Â  Â  Â  const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
Â  Â  Â Â 
Â  Â  Â  let retries = 0;
Â  Â  Â  const maxRetries = 5;
Â  Â  Â  let delay = 1000;
Â  Â  Â Â 
Â  Â  Â  while (retries < maxRetries) {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  const response = await fetch(apiUrl, {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  body: JSON.stringify(payload)
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  throw new Error(`HTTP error! status: ${response.status}`);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  const result = await response.json();
Â  Â  Â  Â  Â  if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
Â  Â  Â  Â  Â  Â  const jsonString = result.candidates[0].content.parts[0].text;
Â  Â  Â  Â  Â  Â  const parsedJson = JSON.parse(jsonString);
Â  Â  Â  Â  Â  Â  return parsedJson;
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  throw new Error('Invalid API response format');
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  if (error.message.includes('429')) {
Â  Â  Â  Â  Â  Â  retries++;
Â  Â  Â  Â  Â  Â  console.warn(`API call failed with status 429. Retrying in ${delay}ms...`);
Â  Â  Â  Â  Â  Â  await new Promise(res => setTimeout(res, delay));
Â  Â  Â  Â  Â  Â  delay *= 2; // Exponential backoff
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  throw error;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  throw new Error('API call failed after multiple retries.');
Â  Â  } catch (error) {
Â  Â  Â  console.error('Failed to get chatbot response:', error);
Â  Â  Â  return { emotion: 'sad', text: "I'm sorry, I seem to be having trouble right now. Please try again later. ğŸ˜”" };
Â  Â  }
Â  }

Â  async function handleSend() {
Â  Â  const userMessage = chatInput.value.trim();
Â  Â  if (userMessage === '') return;
Â Â 
Â  Â  createMessage(userMessage, true);
Â  Â  chatInput.value = '';
Â Â 
Â  Â  const loadingMessage = document.createElement('div');
Â  Â  loadingMessage.className = 'message bot-msg';
Â  Â  loadingMessage.innerHTML = 'Aura is thinking... <span class="loading-spinner">.</span>';
Â  Â  chatWindow.appendChild(loadingMessage);
Â  Â  chatWindow.scrollTop = chatWindow.scrollHeight;
Â Â 
Â  Â  let spinnerInterval = setInterval(() => {
Â  Â  Â  if (loadingMessage.innerHTML.includes('...')) {
Â  Â  Â  Â  loadingMessage.innerHTML = 'Aura is thinking... ';
Â  Â  Â  } else {
Â  Â  Â  Â  loadingMessage.innerHTML += '.';
Â  Â  Â  }
Â  Â  }, 300);

Â  Â  const response = await generateChatResponse(userMessage);
Â  Â Â 
Â  Â  clearInterval(spinnerInterval);
Â  Â  chatWindow.removeChild(loadingMessage);
Â Â 
Â  Â  setBotEmotion(response.emotion);
Â  Â  createMessage(response.text + ` ${emotionThemes[response.emotion].emoji}`, false);
Â  }
Â Â 
Â  chatSendBtn.addEventListener('click', handleSend);
Â  chatInput.addEventListener('keydown', (e) => {
Â  Â  if (e.key === 'Enter') {
Â  Â  Â  handleSend();
Â  Â  }
Â  });
}
</script>

</body>
</html>
